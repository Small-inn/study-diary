## 二维码登陆原理
---

1. PC端与服务端
    * 当页面打开时，会向服务器发一个请求获取登陆二维码
    * 服务器接收请求后，会随机生成一个UUID，将UUID存入服务器，同时设置过期时间，如果过期，重新获取二维码
    * 把UUID和校验信息生成二维码，将二维码和UUID返回给PC端
    * PC页面拿到二维码和UUID后，发起轮询，轮询两种情况：一种是成功，一种是二维码过期，需要用户刷新二维码
2. 移动端与服务端
    * 移动端扫码后，得到UUID和校验信息，因为本地已经登陆，存在当前的用户信息（token、userid等），然后移动端带上用户信息和校验信息，向服务器发送请求
    * 服务器收到请求后，对比参数中的验证信息，判断是否为用户登陆请求接口，如果是，返回一个确认信息给移动端
    * 移动端收到返回后，将登陆确认框给用户，用户确认登陆操作后，移动端再次发送请求
    * 服务器拿到UUID和移动端的用户信息后，修改用户状态，将登陆成功的状态和用户信息返回给PC端
    * pc 端轮询得到登录成功的状态，获取登录信息，登录成功！

*PC 端检测二维码的状态不止轮询一种方式，还有我们熟悉的 socket 也是可以的*

1. socket 的方式：PC 端保持着与服务器的长连接，当手机端扫描二维码后，带着解析得到的二维码 ID 第一次发送给服务器，当服务器收到这个请求后，代表用户已经扫描了二维码，这时服务器就可以通过 socket 告知 PC 端二维码已被扫描，等待确认；之后手机端不论是取消登录还是确认登录，都会相应的请求服务器，服务器收到请求会根据相应的逻辑处理，进而通知 PC 端更新相应的状态
2. 轮询方式：轮询方式即在 PC 端创建一个定时器，每隔一段时间请求服务器查询状态的更新情况，然后更新网页的显示信息。当时这个定时器得控制好启动时机和生命周期，因为 PC 端的二维码有可能一直没有被扫描，或者扫描之后没有下一步操作了，这时，如果没有控制好这个定时器，PC 端就会一直地请求服务器查询，造成资源浪费和一定的性能损耗。